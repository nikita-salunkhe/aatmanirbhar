<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
   
    <title>my_login</title>
</head>
<body onload="init()">
<nav class="navbar text-white navbar-dark bg-dark">
<a href="#" class="navbar-brand">
Login 
</a>
</nav>
    <div class="container text-center bordered" style="width:280px">
    <video onclick="snapshot(this);" width=1050 height=450 id="video" controls autoplay></video>
    <br>
       <button  onclick="login()"  value="login">Login </button>
       <br>
<canvas  id="myCanvas" width="400" height="350" hidden></canvas>  
    </div>
      
  </body>
  <script>
      //--------------------
      // GET USER MEDIA CODE
      //--------------------
          navigator.getUserMedia = ( navigator.getUserMedia ||
                             navigator.webkitGetUserMedia ||
                             navigator.mozGetUserMedia ||
                             navigator.msGetUserMedia);

      var video;
      var webcamStream;
        if (navigator.getUserMedia) {
           navigator.getUserMedia (

              // constraints
              {
                 video: true,
                 audio: false
              },

              // successCallback
              function(localMediaStream) {
                  video = document.querySelector('video');
                 video.srcObject = localMediaStream;
                 webcamStream = localMediaStream;
              },

              // errorCallback
              function(err) {
                 console.log("The following error occured: " + err);
              }
           );
        } else {
           console.log("getUserMedia not supported");
        }  

 
     
      var canvas, ctx;

      function init() {
mcanvas = document.getElementById("myCanvas");
        ctx = mcanvas.getContext('2d');
      }

      function login() {
  
        ctx.drawImage(video,0,0,mcanvas.width,mcanvas.height);
        var dataURL = mcanvas.toDataURL();


         //upload img here and get it's URL
        


         webcamStream.getTracks().forEach(function(track) {
        if (track.readyState == 'live' && track.kind === 'video') {
            track.stop();
        }
    });
         var k="https://res.cloudinary.com/dk4v2avot/image/upload/v1594305871/Shrushti_kk0hof.jpg";
         var str="https://akm-img-a-in.tosshub.com/indiatoday/images/story/202007/vrfvtr-770x433.jpeg?DtaDj6DFc3xMgOizU8tI_yfH1tXPRU2b";
    var data = "photo="+k;
    console.log(data);

var xhr = new XMLHttpRequest();
xhr.withCredentials = false;

xhr.addEventListener("readystatechange", function () {
  if (this.readyState === this.DONE) {
    console.log(this.responseText);
    var response=this.responseText;
   
    if(response.search("name")==-1)
    {
      if(response.search("server"))
      {
        window.alert("Sorry! Internal server error. Please try again.");
      }
      else
      {window.alert("Sorry! You don't have account. Please SignUp first! ");}
      
    }
    else
    {
      var i=23;
      var name="Welcome ";
      var j;
      var res;
      while(response[i]!=",")
      {
        j=response[i];
        name=name.concat(j);
        i=i+1;

      }
      window.alert(name+"!  Happy learning!");



       //add here link of next page


    }

  }
});

xhr.open("POST", "https://luxand-cloud-face-recognition.p.rapidapi.com/photo/search");
xhr.setRequestHeader("x-rapidapi-host", "luxand-cloud-face-recognition.p.rapidapi.com");
xhr.setRequestHeader("x-rapidapi-key", "deb52d4c60msha7a578f27f0154fp1820edjsn2d57098e255d");
xhr.setRequestHeader("content-type", "application/x-www-form-urlencoded");

xhr.send(data);
console.log("request sent");

      }

  </script>
</html>